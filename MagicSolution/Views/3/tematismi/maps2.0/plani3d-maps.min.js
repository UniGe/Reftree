var alysso=alysso||{},plani3d=plani3d||{},alyssoInputDate=getUrlVars.dataRif;String.prototype.startsWithIgnorCase=function(a){return 0===this.toUpperCase().indexOf(a.toUpperCase())};Set.prototype.union=function(a){var f=new Set(this);a=a.values();for(var c=null;c=a.next().value;)f.add(c);return f};Set.prototype.intersection=function(a){var f=new Set;a=a.values();for(var c=null;c=a.next().value;)this.has(c)&&f.add(c);return f};
Set.prototype.difference=function(a){var f=new Set(this);a=a.values();for(var c=null;c=a.next().value;)f["delete"](c);return f};String.prototype.replaceAll=function(a,f){return this.split(a).join(f)};
var alyLatinMap={"Á":"A","Ă":"A","Ắ":"A","Ặ":"A","Ằ":"A","Ẳ":"A","Ẵ":"A","Ǎ":"A","Â":"A","Ấ":"A","Ậ":"A","Ầ":"A","Ẩ":"A","Ẫ":"A","Ä":"A","Ǟ":"A","Ȧ":"A","Ǡ":"A","Ạ":"A","Ȁ":"A","À":"A","Ả":"A","Ȃ":"A","Ā":"A","Ą":"A","Å":"A","Ǻ":"A","Ḁ":"A","Ⱥ":"A","Ã":"A","Ꜳ":"AA","Æ":"AE","Ǽ":"AE","Ǣ":"AE","Ꜵ":"AO","Ꜷ":"AU","Ꜹ":"AV","Ꜻ":"AV","Ꜽ":"AY","Ḃ":"B","Ḅ":"B","Ɓ":"B","Ḇ":"B","Ƀ":"B","Ƃ":"B","Ć":"C","Č":"C","Ç":"C","Ḉ":"C","Ĉ":"C","Ċ":"C","Ƈ":"C","Ȼ":"C","Ď":"D","Ḑ":"D","Ḓ":"D","Ḋ":"D","Ḍ":"D","Ɗ":"D","Ḏ":"D",
"ǲ":"D","ǅ":"D","Đ":"D","Ƌ":"D","Ǳ":"DZ","Ǆ":"DZ","É":"E","Ĕ":"E","Ě":"E","Ȩ":"E","Ḝ":"E","Ê":"E","Ế":"E","Ệ":"E","Ề":"E","Ể":"E","Ễ":"E","Ḙ":"E","Ë":"E","Ė":"E","Ẹ":"E","Ȅ":"E","È":"E","Ẻ":"E","Ȇ":"E","Ē":"E","Ḗ":"E","Ḕ":"E","Ę":"E","Ɇ":"E","Ẽ":"E","Ḛ":"E","Ꝫ":"ET","Ḟ":"F","Ƒ":"F","Ǵ":"G","Ğ":"G","Ǧ":"G","Ģ":"G","Ĝ":"G","Ġ":"G","Ɠ":"G","Ḡ":"G","Ǥ":"G","Ḫ":"H","Ȟ":"H","Ḩ":"H","Ĥ":"H","Ⱨ":"H","Ḧ":"H","Ḣ":"H","Ḥ":"H","Ħ":"H","Í":"I","Ĭ":"I","Ǐ":"I","Î":"I","Ï":"I","Ḯ":"I","İ":"I","Ị":"I","Ȉ":"I","Ì":"I",
"Ỉ":"I","Ȋ":"I","Ī":"I","Į":"I","Ɨ":"I","Ĩ":"I","Ḭ":"I","Ꝺ":"D","Ꝼ":"F","Ᵹ":"G","Ꞃ":"R","Ꞅ":"S","Ꞇ":"T","Ꝭ":"IS","Ĵ":"J","Ɉ":"J","Ḱ":"K","Ǩ":"K","Ķ":"K","Ⱪ":"K","Ꝃ":"K","Ḳ":"K","Ƙ":"K","Ḵ":"K","Ꝁ":"K","Ꝅ":"K","Ĺ":"L","Ƚ":"L","Ľ":"L","Ļ":"L","Ḽ":"L","Ḷ":"L","Ḹ":"L","Ⱡ":"L","Ꝉ":"L","Ḻ":"L","Ŀ":"L","Ɫ":"L","ǈ":"L","Ł":"L","Ǉ":"LJ","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ɱ":"M","Ń":"N","Ň":"N","Ņ":"N","Ṋ":"N","Ṅ":"N","Ṇ":"N","Ǹ":"N","Ɲ":"N","Ṉ":"N","Ƞ":"N","ǋ":"N","Ñ":"N","Ǌ":"NJ","Ó":"O","Ŏ":"O","Ǒ":"O","Ô":"O","Ố":"O",
"Ộ":"O","Ồ":"O","Ổ":"O","Ỗ":"O","Ö":"O","Ȫ":"O","Ȯ":"O","Ȱ":"O","Ọ":"O","Ő":"O","Ȍ":"O","Ò":"O","Ỏ":"O","Ơ":"O","Ớ":"O","Ợ":"O","Ờ":"O","Ở":"O","Ỡ":"O","Ȏ":"O","Ꝋ":"O","Ꝍ":"O","Ō":"O","Ṓ":"O","Ṑ":"O","Ɵ":"O","Ǫ":"O","Ǭ":"O","Ø":"O","Ǿ":"O","Õ":"O","Ṍ":"O","Ṏ":"O","Ȭ":"O","Ƣ":"OI","Ꝏ":"OO","Ɛ":"E","Ɔ":"O","Ȣ":"OU","Ṕ":"P","Ṗ":"P","Ꝓ":"P","Ƥ":"P","Ꝕ":"P","Ᵽ":"P","Ꝑ":"P","Ꝙ":"Q","Ꝗ":"Q","Ŕ":"R","Ř":"R","Ŗ":"R","Ṙ":"R","Ṛ":"R","Ṝ":"R","Ȑ":"R","Ȓ":"R","Ṟ":"R","Ɍ":"R","Ɽ":"R","Ꜿ":"C","Ǝ":"E","Ś":"S","Ṥ":"S",
"Š":"S","Ṧ":"S","Ş":"S","Ŝ":"S","Ș":"S","Ṡ":"S","Ṣ":"S","Ṩ":"S","Ť":"T","Ţ":"T","Ṱ":"T","Ț":"T","Ⱦ":"T","Ṫ":"T","Ṭ":"T","Ƭ":"T","Ṯ":"T","Ʈ":"T","Ŧ":"T","Ɐ":"A","Ꞁ":"L","Ɯ":"M","Ʌ":"V","Ꜩ":"TZ","Ú":"U","Ŭ":"U","Ǔ":"U","Û":"U","Ṷ":"U","Ü":"U","Ǘ":"U","Ǚ":"U","Ǜ":"U","Ǖ":"U","Ṳ":"U","Ụ":"U","Ű":"U","Ȕ":"U","Ù":"U","Ủ":"U","Ư":"U","Ứ":"U","Ự":"U","Ừ":"U","Ử":"U","Ữ":"U","Ȗ":"U","Ū":"U","Ṻ":"U","Ų":"U","Ů":"U","Ũ":"U","Ṹ":"U","Ṵ":"U","Ꝟ":"V","Ṿ":"V","Ʋ":"V","Ṽ":"V","Ꝡ":"VY","Ẃ":"W","Ŵ":"W","Ẅ":"W","Ẇ":"W",
"Ẉ":"W","Ẁ":"W","Ⱳ":"W","Ẍ":"X","Ẋ":"X","Ý":"Y","Ŷ":"Y","Ÿ":"Y","Ẏ":"Y","Ỵ":"Y","Ỳ":"Y","Ƴ":"Y","Ỷ":"Y","Ỿ":"Y","Ȳ":"Y","Ɏ":"Y","Ỹ":"Y","Ź":"Z","Ž":"Z","Ẑ":"Z","Ⱬ":"Z","Ż":"Z","Ẓ":"Z","Ȥ":"Z","Ẕ":"Z","Ƶ":"Z","Ĳ":"IJ","Œ":"OE","ᴀ":"A","ᴁ":"AE","ʙ":"B","ᴃ":"B","ᴄ":"C","ᴅ":"D","ᴇ":"E","ꜰ":"F","ɢ":"G","ʛ":"G","ʜ":"H","ɪ":"I","ʁ":"R","ᴊ":"J","ᴋ":"K","ʟ":"L","ᴌ":"L","ᴍ":"M","ɴ":"N","ᴏ":"O","ɶ":"OE","ᴐ":"O","ᴕ":"OU","ᴘ":"P","ʀ":"R","ᴎ":"N","ᴙ":"R","ꜱ":"S","ᴛ":"T","ⱻ":"E","ᴚ":"R","ᴜ":"U","ᴠ":"V","ᴡ":"W",
"ʏ":"Y","ᴢ":"Z","á":"a","ă":"a","ắ":"a","ặ":"a","ằ":"a","ẳ":"a","ẵ":"a","ǎ":"a","â":"a","ấ":"a","ậ":"a","ầ":"a","ẩ":"a","ẫ":"a","ä":"a","ǟ":"a","ȧ":"a","ǡ":"a","ạ":"a","ȁ":"a","à":"a","ả":"a","ȃ":"a","ā":"a","ą":"a","ᶏ":"a","ẚ":"a","å":"a","ǻ":"a","ḁ":"a","ⱥ":"a","ã":"a","ꜳ":"aa","æ":"ae","ǽ":"ae","ǣ":"ae","ꜵ":"ao","ꜷ":"au","ꜹ":"av","ꜻ":"av","ꜽ":"ay","ḃ":"b","ḅ":"b","ɓ":"b","ḇ":"b","ᵬ":"b","ᶀ":"b","ƀ":"b","ƃ":"b","ɵ":"o","ć":"c","č":"c","ç":"c","ḉ":"c","ĉ":"c","ɕ":"c","ċ":"c","ƈ":"c","ȼ":"c","ď":"d",
"ḑ":"d","ḓ":"d","ȡ":"d","ḋ":"d","ḍ":"d","ɗ":"d","ᶑ":"d","ḏ":"d","ᵭ":"d","ᶁ":"d","đ":"d","ɖ":"d","ƌ":"d","ı":"i","ȷ":"j","ɟ":"j","ʄ":"j","ǳ":"dz","ǆ":"dz","é":"e","ĕ":"e","ě":"e","ȩ":"e","ḝ":"e","ê":"e","ế":"e","ệ":"e","ề":"e","ể":"e","ễ":"e","ḙ":"e","ë":"e","ė":"e","ẹ":"e","ȅ":"e","è":"e","ẻ":"e","ȇ":"e","ē":"e","ḗ":"e","ḕ":"e","ⱸ":"e","ę":"e","ᶒ":"e","ɇ":"e","ẽ":"e","ḛ":"e","ꝫ":"et","ḟ":"f","ƒ":"f","ᵮ":"f","ᶂ":"f","ǵ":"g","ğ":"g","ǧ":"g","ģ":"g","ĝ":"g","ġ":"g","ɠ":"g","ḡ":"g","ᶃ":"g","ǥ":"g","ḫ":"h",
"ȟ":"h","ḩ":"h","ĥ":"h","ⱨ":"h","ḧ":"h","ḣ":"h","":"h","ɦ":"h","ẖ":"h","ħ":"h","ƕ":"hv","í":"i","ĭ":"i","ǐ":"i","î":"i","ï":"i","ḯ":"i","ị":"i","ȉ":"i","ì":"i","ỉ":"i","ȋ":"i","ī":"i","į":"i","ᶖ":"i","ɨ":"i","ĩ":"i","ḭ":"i","ꝺ":"d","ꝼ":"f","ᵹ":"g","ꞃ":"r","ꞅ":"s","ꞇ":"t","ꝭ":"is","ǰ":"j","ĵ":"j","ʝ":"j","ɉ":"j","ḱ":"k","ǩ":"k","ķ":"k","ⱪ":"k","ꝃ":"k","ḳ":"k","ƙ":"k","ḵ":"k","ᶄ":"k","ꝁ":"k","ꝅ":"k","ĺ":"l","ƚ":"l","ɬ":"l","ľ":"l","ļ":"l","ḽ":"l","ȴ":"l","ḷ":"l","ḹ":"l","ⱡ":"l","ꝉ":"l","ḻ":"l","ŀ":"l",
"ɫ":"l","ᶅ":"l","ɭ":"l","ł":"l","ǉ":"lj","ſ":"s","ẜ":"s","ẛ":"s","ẝ":"s","ḿ":"m","ṁ":"m","ṃ":"m","ɱ":"m","ᵯ":"m","ᶆ":"m","ń":"n","ň":"n","ņ":"n","ṋ":"n","ȵ":"n","ṅ":"n","ṇ":"n","ǹ":"n","ɲ":"n","ṉ":"n","ƞ":"n","ᵰ":"n","ᶇ":"n","ɳ":"n","ñ":"n","ǌ":"nj","ó":"o","ŏ":"o","ǒ":"o","ô":"o","ố":"o","ộ":"o","ồ":"o","ổ":"o","ỗ":"o","ö":"o","ȫ":"o","ȯ":"o","ȱ":"o","ọ":"o","ő":"o","ȍ":"o","ò":"o","ỏ":"o","ơ":"o","ớ":"o","ợ":"o","ờ":"o","ở":"o","ỡ":"o","ȏ":"o","ꝋ":"o","ꝍ":"o","ⱺ":"o","ō":"o","ṓ":"o","ṑ":"o","ǫ":"o",
"ǭ":"o","ø":"o","ǿ":"o","õ":"o","ṍ":"o","ṏ":"o","ȭ":"o","ƣ":"oi","ꝏ":"oo","ɛ":"e","ᶓ":"e","ɔ":"o","ᶗ":"o","ȣ":"ou","ṕ":"p","ṗ":"p","ꝓ":"p","ƥ":"p","ᵱ":"p","ᶈ":"p","ꝕ":"p","ᵽ":"p","ꝑ":"p","ꝙ":"q","ʠ":"q","ɋ":"q","ꝗ":"q","ŕ":"r","ř":"r","ŗ":"r","ṙ":"r","ṛ":"r","ṝ":"r","ȑ":"r","ɾ":"r","ᵳ":"r","ȓ":"r","ṟ":"r","ɼ":"r","ᵲ":"r","ᶉ":"r","ɍ":"r","ɽ":"r","ↄ":"c","ꜿ":"c","ɘ":"e","ɿ":"r","ś":"s","ṥ":"s","š":"s","ṧ":"s","ş":"s","ŝ":"s","ș":"s","ṡ":"s","ṣ":"s","ṩ":"s","ʂ":"s","ᵴ":"s","ᶊ":"s","ȿ":"s","ɡ":"g","ᴑ":"o",
"ᴓ":"o","ᴝ":"u","ť":"t","ţ":"t","ṱ":"t","ț":"t","ȶ":"t","ẗ":"t","ⱦ":"t","ṫ":"t","ṭ":"t","ƭ":"t","ṯ":"t","ᵵ":"t","ƫ":"t","ʈ":"t","ŧ":"t","ᵺ":"th","ɐ":"a","ᴂ":"ae","ǝ":"e","ᵷ":"g","ɥ":"h","ʮ":"h","ʯ":"h","ᴉ":"i","ʞ":"k","ꞁ":"l","ɯ":"m","ɰ":"m","ᴔ":"oe","ɹ":"r","ɻ":"r","ɺ":"r","ⱹ":"r","ʇ":"t","ʌ":"v","ʍ":"w","ʎ":"y","ꜩ":"tz","ú":"u","ŭ":"u","ǔ":"u","û":"u","ṷ":"u","ü":"u","ǘ":"u","ǚ":"u","ǜ":"u","ǖ":"u","ṳ":"u","ụ":"u","ű":"u","ȕ":"u","ù":"u","ủ":"u","ư":"u","ứ":"u","ự":"u","ừ":"u","ử":"u","ữ":"u","ȗ":"u",
"ū":"u","ṻ":"u","ų":"u","ᶙ":"u","ů":"u","ũ":"u","ṹ":"u","ṵ":"u","ᵫ":"ue","ꝸ":"um","ⱴ":"v","ꝟ":"v","ṿ":"v","ʋ":"v","ᶌ":"v","ⱱ":"v","ṽ":"v","ꝡ":"vy","ẃ":"w","ŵ":"w","ẅ":"w","ẇ":"w","ẉ":"w","ẁ":"w","ⱳ":"w","ẘ":"w","ẍ":"x","ẋ":"x","ᶍ":"x","ý":"y","ŷ":"y","ÿ":"y","ẏ":"y","ỵ":"y","ỳ":"y","ƴ":"y","ỷ":"y","ỿ":"y","ȳ":"y","ẙ":"y","ɏ":"y","ỹ":"y","ź":"z","ž":"z","ẑ":"z","ʑ":"z","ⱬ":"z","ż":"z","ẓ":"z","ȥ":"z","ẕ":"z","ᵶ":"z","ᶎ":"z","ʐ":"z","ƶ":"z","ɀ":"z","ﬀ":"ff","ﬃ":"ffi","ﬄ":"ffl","ﬁ":"fi","ﬂ":"fl","ĳ":"ij",
"œ":"oe","ﬆ":"st","ₐ":"a","ₑ":"e","ᵢ":"i","ⱼ":"j","ₒ":"o","ᵣ":"r","ᵤ":"u","ᵥ":"v","ₓ":"x"};String.prototype.alyLatinize=function(){return this.replace(/[^A-Za-z0-9\[\] ]/g,function(a){return alyLatinMap[a]||a})};
plani3d.Config=function(a){this.server=a.server;this.maps=a.maps;this.geojson=new ol.format.GeoJSON;this.map;this.mapProjectionCode;this.dataAsJson;this.strJsonDataType="json";this.strApplicationJson="application/json";this.inputValidityDate;this.lastIdentifyTime;this.otherLayers=[];this.wfsService="/wfs";this.wmsService="/wms";this.requestMaxLength=65E3;this.init=function(){this.prepareBlockUIPanel()};this.baseLayerTypeSAT="SAT";this.baseLayerTypeRV="RV";this.baseLayerTypeCAT="CAT";this.baseLayerTypeOSM=
"OSM";this.baseLayerTypeSTA="STA";this.baseLayerTypeVectorPrefix="v_";this.validityDateTimeSection="T00:00:00.001Z";this.prepareBlockUIPanel=function(){$.blockUI.defaults={message:'\x3cimg src\x3d"./imgs/loading.gif" style\x3d"height: 20px; vertical-align: middle; padding-right: 8px;"/\x3e\x3cspan style\x3d"vertical-align: middle;"\x3eAttendere...\x3c/span\x3e',theme:!1,css:{margin:0,width:"20%",top:"40%",left:"40%",textAlign:"center",cursor:"defautl",border:"none",padding:"15px",backgroundColor:"#000",
"border-radius":"10px","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"},themedCSS:{width:"30%",top:"40%",left:"35%"},overlayCSS:{backgroundColor:"#000",opacity:.6,cursor:"default"},cursorReset:"default",growlCSS:{width:"350px",top:"10px",left:"",right:"10px",padding:"5px",opacity:.6,color:"#fff",backgroundColor:"#000",cursor:null,border:"none","border-radius":"10px","-webkit-border-radius":"10px","-moz-border-radius":"10px"},centerX:!0,centerY:!0,allowBodyStretch:!0,
bindEvents:!0,constrainTabKey:!0,fadeIn:300,fadeOut:300,timeout:0,showOverlay:!0,quirksmodeOffsetHack:4,blockMsgClass:"p3d-blockMsg",ignoreIfBlocked:!1}}};var lasciamiPerIlMinifier="";
(function(){var a=document.getElementById("copy-button");if(a){var f=document.getElementById("example-source").textContent;(new ZeroClipboard(a)).on("copy",function(a){a.clipboardData.setData({"text/plain":f,"text/html":f})})}if(a=document.getElementById("jsfiddle-button"))a.onclick=function(a){a.preventDefault();document.getElementById("jsfiddle-form").submit()};if("localhost:3000"!==window.location.host&&(a=document.getElementById("navbar-logo-container"))){var c=document.createElement("form"),
d=document.createElement("select"),r={raw:"Development",advanced:"Production"},v=window.location.href.match(/mode=([a-z0-9\-]+)\&?/i),v=v?v[1]:"advanced",m;for(m in r)if(r.hasOwnProperty(m)){var g=document.createElement("option"),t=r[m];g.value=m;g.innerHTML=t;g.selected=v===m;d.appendChild(g)}d.onchange=function(a){a=a.target.value;for(var c=window.location.search.substring(1),f=window.location.href.split("?")[0],c=c?c.split("\x26"):[],r=[],d=!1,m=c.length-1;0<=m;--m){var g=c[m].split("\x3d");"mode"===
g[0].toLowerCase()&&(g[1]=a,d=!0);var v=encodeURIComponent(g[0]);void 0!==typeof g[1]&&(v+="\x3d"+encodeURIComponent(g[1]||""));r.push(v)}d||r.push("mode\x3d"+encodeURIComponent(a));location.href=f+"?"+r.join("\x26")};d.className="input-medium";c.className="navbar-form version-form";c.appendChild(d);a.appendChild(c)}})();
var common={getRendererFromQueryString:function(a){for(var f={},c=location.search.slice(1),d=/([^&=]+)=([^&]*)/g,r=d.exec(c);r;)f[decodeURIComponent(r[1])]=decodeURIComponent(r[2]),r=d.exec(c);return"renderers"in f?f.renderers.split(","):"renderer"in f?[f.renderer]:a}};self="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{};
var Prism=function(){var a=/\blang(?:uage)?-(?!\*)(\w+)\b/i,f=self.Prism={util:{encode:function(a){return a instanceof c?new c(a.type,f.util.encode(a.content),a.alias):"Array"===f.util.type(a)?a.map(f.util.encode):a.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/\u00a0/g," ")},type:function(a){return Object.prototype.toString.call(a).match(/\[object (\w+)\]/)[1]},clone:function(a){switch(f.util.type(a)){case "Object":var c={},d;for(d in a)a.hasOwnProperty(d)&&(c[d]=f.util.clone(a[d]));
return c;case "Array":return a.map(function(a){return f.util.clone(a)})}return a}},languages:{extend:function(a,c){var d=f.util.clone(f.languages[a]),g;for(g in c)d[g]=c[g];return d},insertBefore:function(a,c,d,g){g=g||f.languages;var t=g[a];if(2==arguments.length){d=arguments[1];for(var q in d)d.hasOwnProperty(q)&&(t[q]=d[q]);return t}var s={},u;for(u in t)if(t.hasOwnProperty(u)){if(u==c)for(q in d)d.hasOwnProperty(q)&&(s[q]=d[q]);s[u]=t[u]}return f.languages.DFS(f.languages,function(c,f){f===g[a]&&
c!=a&&(this[c]=s)}),g[a]=s},DFS:function(a,c,d){for(var g in a)a.hasOwnProperty(g)&&(c.call(a,g,a[g],d||g),"Object"===f.util.type(a[g])?f.languages.DFS(a[g],c):"Array"===f.util.type(a[g])&&f.languages.DFS(a[g],c,g))}},highlightAll:function(a,c){for(var d,g=document.querySelectorAll('code[class*\x3d"language-"], [class*\x3d"language-"] code, code[class*\x3d"lang-"], [class*\x3d"lang-"] code'),t=0;d=g[t++];)f.highlightElement(d,!0===a,c)},highlightElement:function(d,v,m){for(var g,t,q=d;q&&!a.test(q.className);)q=
q.parentNode;if(q&&(g=(q.className.match(a)||[,""])[1],t=f.languages[g]),t)if(d.className=d.className.replace(a,"").replace(/\s+/g," ")+" language-"+g,q=d.parentNode,/pre/i.test(q.nodeName)&&(q.className=q.className.replace(a,"").replace(/\s+/g," ")+" language-"+g),q=d.textContent){var q=q.replace(/^(?:\r?\n|\r)/,""),s={element:d,language:g,grammar:t,code:q};(f.hooks.run("before-highlight",s),v&&self.Worker)?(d=new Worker(f.filename),d.onmessage=function(a){s.highlightedCode=c.stringify(JSON.parse(a.data),
g);f.hooks.run("before-insert",s);s.element.innerHTML=s.highlightedCode;m&&m.call(s.element);f.hooks.run("after-highlight",s)},d.postMessage(JSON.stringify({language:s.language,code:s.code}))):(s.highlightedCode=f.highlight(s.code,s.grammar,s.language),f.hooks.run("before-insert",s),s.element.innerHTML=s.highlightedCode,m&&m.call(d),f.hooks.run("after-highlight",s))}},highlight:function(a,d,m){a=f.tokenize(a,d);return c.stringify(f.util.encode(a),m)},tokenize:function(a,c){var d=f.Token,g=[a],t=c.rest;
if(t){for(var q in t)c[q]=t[q];delete c.rest}a:for(q in c)if(c.hasOwnProperty(q)&&c[q])for(var t=c[q],t="Array"===f.util.type(t)?t:[t],s=0;s<t.length;++s)for(var u=t[s],J=u.inside,E=!!u.lookbehind,F=0,C=u.alias,u=u.pattern||u,w=0;w<g.length;w++){var y=g[w];if(g.length>a.length)break a;if(!(y instanceof d)){u.lastIndex=0;var x=u.exec(y);if(x){E&&(F=x[1].length);var z=x.index-1+F,x=x[0].slice(F),A=z+x.length,z=y.slice(0,z+1),y=y.slice(A+1),A=[w,1];z&&A.push(z);x=new d(q,J?f.tokenize(x,J):x,C);A.push(x);
y&&A.push(y);Array.prototype.splice.apply(g,A)}}}return g},hooks:{all:{},add:function(a,c){var d=f.hooks.all;d[a]=d[a]||[];d[a].push(c)},run:function(a,c){var d=f.hooks.all[a];if(d&&d.length)for(var g,t=0;g=d[t++];)g(c)}}},c=f.Token=function(a,c,f){this.type=a;this.content=c;this.alias=f};if(c.stringify=function(a,d,m){if("string"==typeof a)return a;if("Array"===f.util.type(a))return a.map(function(f){return c.stringify(f,d,a)}).join("");m={type:a.type,content:c.stringify(a.content,d,m),tag:"span",
classes:["token",a.type],attributes:{},language:d,parent:m};if("comment"==m.type&&(m.attributes.spellcheck="true"),a.alias){var g="Array"===f.util.type(a.alias)?a.alias:[a.alias];Array.prototype.push.apply(m.classes,g)}f.hooks.run("wrap",m);var g="",t;for(t in m.attributes)g+=t+'\x3d"'+(m.attributes[t]||"")+'"';return"\x3c"+m.tag+' class\x3d"'+m.classes.join(" ")+'" '+g+"\x3e"+m.content+"\x3c/"+m.tag+"\x3e"},!self.document)return self.addEventListener?(self.addEventListener("message",function(a){a=
JSON.parse(a.data);self.postMessage(JSON.stringify(f.util.encode(f.tokenize(a.code,f.languages[a.language]))));self.close()},!1),self.Prism):self.Prism;var d=document.getElementsByTagName("script");return d=d[d.length-1],d&&(f.filename=d.src,document.addEventListener&&!d.hasAttribute("data-manual")&&document.addEventListener("DOMContentLoaded",f.highlightAll)),self.Prism}();"undefined"!=typeof module&&module.exports&&(module.exports=Prism);
Prism.languages.markup={comment:/\x3c!--[\w\W]*?--\x3e/,prolog:/<\?.+?\?>/,doctype:/<!DOCTYPE.+?>/,cdata:/<!\[CDATA\[[\w\W]*?]]\x3e/i,tag:{pattern:/<\/?[\w:-]+\s*(?:\s+[\w:-]+(?:=(?:("|')(\\?[\w\W])*?\1|[^\s'">=]+))?\s*)*\/?>/i,inside:{tag:{pattern:/^<\/?[\w:-]+/i,inside:{punctuation:/^<\/?/,namespace:/^[\w-]+?:/}},"attr-value":{pattern:/=(?:('|")[\w\W]*?(\1)|[^\s>]+)/i,inside:{punctuation:/=|>|"/}},punctuation:/\/?>/,"attr-name":{pattern:/[\w:-]+/,inside:{namespace:/^[\w-]+?:/}}}},entity:/&#?[\da-z]{1,8};/i};
Prism.hooks.add("wrap",function(a){"entity"===a.type&&(a.attributes.title=a.content.replace(/&amp;/,"\x26"))});Prism.languages.css={comment:/\/\*[\w\W]*?\*\//,atrule:{pattern:/@[\w-]+?.*?(;|(?=\s*\{))/i,inside:{punctuation:/[;:]/}},url:/url\((?:(["'])(\\\n|\\?.)*?\1|.*?)\)/i,selector:/[^\{\}\s][^\{\};]*(?=\s*\{)/,string:/("|')(\\\n|\\?.)*?\1/,property:/(\b|\B)[\w-]+(?=\s*:)/i,important:/\B!important\b/i,punctuation:/[\{\};:]/,"function":/[-a-z0-9]+(?=\()/i};
Prism.languages.markup&&(Prism.languages.insertBefore("markup","tag",{style:{pattern:/<style[\w\W]*?>[\w\W]*?<\/style>/i,inside:{tag:{pattern:/<style[\w\W]*?>|<\/style>/i,inside:Prism.languages.markup.tag.inside},rest:Prism.languages.css},alias:"language-css"}}),Prism.languages.insertBefore("inside","attr-value",{"style-attr":{pattern:/\s*style=("|').*?\1/i,inside:{"attr-name":{pattern:/^\s*style/i,inside:Prism.languages.markup.tag.inside},punctuation:/^\s*=\s*['"]|['"]\s*$/,"attr-value":{pattern:/.+/i,
inside:Prism.languages.css}},alias:"language-css"}},Prism.languages.markup.tag));
Prism.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\w\W]*?\*\//,lookbehind:!0},{pattern:/(^|[^\\:])\/\/.+/,lookbehind:!0}],string:/("|')(\\\n|\\?.)*?\1/,"class-name":{pattern:/((?:(?:class|interface|extends|implements|trait|instanceof|new)\s+)|(?:catch\s+\())[a-z0-9_\.\\]+/i,lookbehind:!0,inside:{punctuation:/(\.|\\)/}},keyword:/\b(if|else|while|do|for|return|in|instanceof|function|new|try|throw|catch|finally|null|break|continue)\b/,"boolean":/\b(true|false)\b/,"function":{pattern:/[a-z0-9_]+\(/i,
inside:{punctuation:/\(/}},number:/\b-?(0x[\dA-Fa-f]+|\d*\.?\d+([Ee]-?\d+)?)\b/,operator:/[-+]{1,2}|!|<=?|>=?|={1,3}|&{1,2}|\|?\||\?|\*|\/|~|\^|%/,ignore:/&(lt|gt|amp);/i,punctuation:/[{}[\];(),.:]/};
Prism.languages.javascript=Prism.languages.extend("clike",{keyword:/\b(break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|false|finally|for|function|get|if|implements|import|in|instanceof|interface|let|new|null|package|private|protected|public|return|set|static|super|switch|this|throw|true|try|typeof|var|void|while|with|yield)\b/,number:/\b-?(0x[\dA-Fa-f]+|\d*\.?\d+([Ee][+-]?\d+)?|NaN|-?Infinity)\b/,"function":/(?!\d)[a-z0-9_$]+(?=\()/i});
Prism.languages.insertBefore("javascript","keyword",{regex:{pattern:/(^|[^/])\/(?!\/)(\[.+?]|\\.|[^/\r\n])+\/[gim]{0,3}(?=\s*($|[\r\n,.;})]))/,lookbehind:!0}});Prism.languages.markup&&Prism.languages.insertBefore("markup","tag",{script:{pattern:/<script[\w\W]*?>[\w\W]*?<\/script>/i,inside:{tag:{pattern:/<script[\w\W]*?>|<\/script>/i,inside:Prism.languages.markup.tag.inside},rest:Prism.languages.javascript},alias:"language-javascript"}});
alysso.Utils=function(a){this.objConfig=a;this.isNumeric=function(a){return!isNaN(a)};this.getTodayFormatted=function(){var a=new Date,c=a.getDate(),c=10>c?"0"+c:c,d=a.getMonth()+1,d=10>d?"0"+d:d;return a.getFullYear()+"-"+d+"-"+c};this.getDateInWFSFormat=function(a){return a+this.objConfig.validityDateTimeSection};this.storeGeneralCallTimeAndReturnIt=function(){var a=(new Date).getTime();return this.objConfig.lastIdentifyTime=a};this.capitalizeFirstCharacter=function(a){if("undefined"!=typeof a&&
0<a.length)return a.charAt(0).toUpperCase()+a.slice(1)};this.setInternalNulls=function(a){a=JSON.stringify(a,function(a,f){return null==f||"null"==f?"":"string"===$.type(f)?f.replaceAll('"',"'"):f});return JSON.parse(a)};this.getObjFromArrayByPropValue=function(a,c,d){for(var r in a)if("undefined"!=typeof a[r][c]&&a[r][c]==d)return a[r];return{}};this.addGeometryFeatureToHighlightLayerVector=function(a,c,d){if("Point"==a.getType()){var r=new ol.Feature({geometry:a});c.getSource().addFeature(r)}else for(r in a=
a.getPolygons(),a)d=new ol.Feature({geometry:a[r]}),c.getSource().addFeature(d)};this.dehighlightSelection=function(a){a.getSource().clear()};this.isContainedInArray=function(a,c){for(var d in c)if(c[d]==a)return!0;return!1};this.getPropValueFromArray=function(a,c,d,r){var v="",m;for(m in a)if("undefined"!=typeof a[m][c]&&a[m][c]==d&&"undefined"!=typeof a[m][r]){v=a[m][r];break}return v};this.getWebappUrl=function(a,c){return a+"://"+c};this.getServerUrl=function(a,c,d){return this.getWebappUrl(a,
c)+"/"+d};this.resizeBodyHeight=function(){$("body").css("height",window.innerHeight+"px")};this.resizeHeighDiv=function(a,c,d){var r=0;d&&(r=d.height());newHeight=parseInt(""+r*c/100);$(a).height(newHeight)};this.tableToJson=function(a){var c={};a=a.substring(a.indexOf("\x3ctd\x3e")+4,a.length);a=a.substring(0,a.lastIndexOf("\x3c/td\x3e"));a=a.split("\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e");for(var d in a){var r=a[d].split("\x3c/td\x3e\x3ctd\x3e");c[r[0]]=r[1]}return c}};
plani3d.Maps=function(a){var f=!1;a.ol&&a.proj4&&(a.proj4.defs("EPSG:25832","+proj\x3dutm +zone\x3d32 +ellps\x3dGRS80 +units\x3dm +no_defs"),a.proj4.defs("EPSG:32632","+proj\x3dutm +zone\x3d32 +datum\x3dWGS84 +units\x3dm +no_defs"),a.proj4.defs("EPSG:23032","+proj\x3dutm +zone\x3d32 +ellps\x3dintl +units\x3dm +no_defs"),a.proj4.defs("EPSG:3003","+proj\x3dtmerc +lat_0\x3d0 +lon_0\x3d9 +k\x3d0.9996 +x_0\x3d1500000 +y_0\x3d0 +ellps\x3dintl +towgs84\x3d-104.1,-49.1,-9.9,0.971,-2.917,0.714,-11.68 +units\x3dm +no_defs"),
a.proj4.defs("EPSG:6706","+proj\x3dlonglat +ellps\x3dGRS80 +towgs84\x3d0,0,0,0,0,0,0 +no_defs"),a.proj4.defs("EPSG:4258","+proj\x3dlonglat +ellps\x3dGRS80 +towgs84\x3d0,0,0,0,0,0,0 +no_defs"),a.ol.proj.setProj4(a.proj4));"undefined"===typeof a.imgpath&&(a.imgpath="");"undefined"===typeof a.protocol&&(a.protocol="http");"undefined"===typeof a.webapp&&(a.webapp="plani3d-srv");"undefined"===typeof a.maps&&(a.maps="default");"undefined"===typeof a.target&&(a.target="p3dt-map");"undefined"===typeof a.debug&&
(a.debug=!1);var c=new plani3d.Config({server:a.server}),d=new alysso.Utils(c);"undefined"===typeof alyssoInputDate||""==alyssoInputDate?c.inputValidityDate=d.getTodayFormatted():checkDateFormat(alyssoInputDate)?c.inputValidityDate=alyssoInputDate:(alert("ATTENZIONE: formato data in input non riconosciuto. Utilizzata la data odierna"),console.log("checkDateFormat ha dato esito negativo, utilizzata data odierna"),c.inputValidityDate=d.getTodayFormatted());var r,v=[],m={},g=[],t=[],q=[],s,u,J,E,F,C,
w,y,x=!1,z=!1,A,M,B,K,T=Array(22),U=Array(22),V={Point:[new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"rgba(0,0,0,0)"}),stroke:new ol.style.Stroke({color:"rgba(0,0,0,0)"})})})],MultiPolygon:[new ol.style.Style({stroke:new ol.style.Stroke({color:"rgba(0,0,0,0)",width:1}),fill:new ol.style.Fill({color:"rgba(0,0,0,0)"})})],Polygon:[new ol.style.Style({stroke:new ol.style.Stroke({color:"rgba(0,0,0,0)",width:1}),fill:new ol.style.Fill({color:"rgba(0,0,0,0)"})})]};
this.init=function(){$.ajax({type:"GET",url:d.getServerUrl(a.protocol,a.server,a.webapp)+"/i?s\x3d"+window.location.href,contentType:c.strApplicationJson,async:!0});p(!0);return $.ajax({type:"GET",url:d.getServerUrl(a.protocol,a.server,a.webapp)+"/config?loadAllConfig\x3dtrue\x26code\x3d"+a.maps,contentType:c.strApplicationJson,dataType:c.strJsonDataType,async:!0,context:this,success:function(a){c.dataAsJson=a;da();p(!1)},error:function(a){0==a.status?$.blockUI({message:"Un ad-blocker impedisce il corretto funzionamento della pagina.\x3cbr\x3eDisabilita ad-blocker per continuare!",
timeout:1E4}):$.blockUI({message:"Problema nel caricamento della configurazione di sistema",timeout:2E3});p(!1)}})};var L=0,p=function(b){b?($("#"+a.target+" #myprogress").fadeIn(200),L++):0<L&&L--;0==L&&$("#"+a.target+" #myprogress").fadeOut(200)},da=function(){p(!0);"undefined"===typeof a.center&&(a.center=c.dataAsJson.centerCoords);"undefined"===typeof a.zoom&&(a.zoom=c.dataAsJson.initialZoom);c.mapProjectionCode=c.dataAsJson.epsgCode;epsg="EPSG:"+c.mapProjectionCode;for(var b=0;22>b;++b)T[b]=
ol.extent.getWidth(ol.proj.get(epsg).getExtent())/256/Math.pow(2,b),U[b]=b;r=new ol.View({center:a.center,zoom:a.zoom,maxZoom:c.dataAsJson.maxZoom});for(var l in c.dataAsJson.baseLayers){var b=c.dataAsJson.baseLayers[l],h=!0,e;b.type==c.baseLayerTypeSAT?e=new ol.layer.Tile({id:b.type,label:b.label,show:b.show,source:new ol.source.WMTS({url:b.url,layer:b.name,matrixSet:epsg,format:"image/png",projection:ol.proj.get(epsg),tileGrid:new ol.tilegrid.WMTS({origin:ol.extent.getTopLeft(ol.proj.get(epsg).getExtent()),
resolutions:T,matrixIds:U}),style:"default",wrapX:!0,attributions:[new ol.Attribution({html:"Powered by \x3ca href\x3d'http://alysso.it/' target\x3d'_blank'\x3eAlysso s.r.l.\x3c/a\x3e | \x3ca href\x3d'https://www.arcgis.com/home/index.html'\x3eArcGIS\x3c/a\x3e contributors."})]})}):b.type==c.baseLayerTypeRV?e=new ol.layer.Tile({id:b.type,label:b.label,show:b.show,source:new ol.source.TileWMS({url:b.url,params:{LAYERS:b.name},attributions:[new ol.Attribution({html:"Powered by \x3ca href\x3d'http://alysso.it/' target\x3d'_blank'\x3eAlysso s.r.l.\x3c/a\x3e | \x3ca href\x3d'https://tinyurl.com/ybvhxjju'\x3eRealVistaWhere\x3c/a\x3e contributors."})]})}):
b.type==c.baseLayerTypeSTA?e=new ol.layer.Tile({id:b.type,label:b.label,show:b.show,source:new ol.source.Stamen({layer:"toner",attributions:[new ol.Attribution({html:"Powered by \x3ca href\x3d'http://alysso.it/' target\x3d'_blank'\x3eAlysso s.r.l.\x3c/a\x3e | \x3ca href\x3d'http://http://maps.stamen.com'\x3eStamen\x3c/a\x3e contributors."})]})}):b.type==c.baseLayerTypeOSM?(e=null,e="undefined"===typeof b.url?new ol.source.OSM:new ol.source.OSM({url:b.url,crossOrigin:null,params:{LAYERS:b.name},attributions:[new ol.Attribution({html:"Powered by \x3ca href\x3d'http://alysso.it/' target\x3d'_blank'\x3eAlysso s.r.l.\x3c/a\x3e | \x3ca href\x3d'https://www.openstreetmap.org'\x3emy OpenStreetMap\x3c/a\x3e contributors."})]}),
e=new ol.layer.Tile({id:b.type,label:b.label,show:b.show,source:e})):b.type.substr(0,c.baseLayerTypeVectorPrefix.length)==c.baseLayerTypeVectorPrefix?e=b.isTiled?new ol.layer.Tile({id:b.type,label:b.label,show:b.show,source:new ol.source.TileWMS({url:b.url,projection:ol.proj.get(epsg),params:{LAYERS:b.name,URLPROXY:b.urlProxy,NS:b.featureNameSpace,PREFIX:b.prefixName,FIELDFILTER:b.fieldFilter},serverType:b.serverType})}):new ol.layer.Image({id:b.type,label:b.label,show:b.show,source:new ol.source.ImageWMS({ratio:1,
url:b.url,params:{FORMAT:"image/png",VERSION:"1.1.1",LAYERS:b.name,URLPROXY:b.urlProxy,NS:b.featureNameSpace,PREFIX:b.prefixName,FIELDFILTER:b.fieldFilter}})}):(console.log("Tipologia di layer '"+b.type+"' non gestita"),h=!1);h&&(t[b.type]=e)}c.map=new ol.Map({layers:ea(),target:a.target,controls:ol.control.defaults({attributionOptions:{collapsible:!1}}).extend([new ol.control.MousePosition({coordinateFormat:ol.coordinate.createStringXY(0),projection:epsg,undefinedHTML:"\x26nbsp;"})]),view:r});$("#p3dt-map").on("resize",
function(){c.map.updateSize()});for(var N in c.otherLayers)c.map.addLayer(c.otherLayers[N]);fa();a.debug&&console.log("createProgressBar");$("#"+a.target+" .ol-viewport .ol-overlaycontainer-stopevent").append($("\x3cdiv\x3e").attr("class","progress progress-striped active").attr("id","myprogress"));$("#"+a.target+" #myprogress").append($("\x3cdiv\x3e").attr("class","progress-bar progress-bar-striped").attr("id","myprogressbar").attr("role","progressbar").attr("style","width:100%"));c.init();void 0!==
typeof a.autoresize&&1==a.autoresize&&$(document).ready(function(){d.resizeBodyHeight();$(window).resize(function(){d.resizeBodyHeight()})});f=!0;console.log("map init completed");p(!1)};this.registerToResize=function(b,c){q.push({id:b,rate:c});for(var h in q)d.resizeHeighDiv(q[h].id,q[h].rate,$("#"+a.target));$(window).resize(function(){for(var b in q)d.resizeHeighDiv(q[b].id,q[b].rate,$("#"+a.target))})};var ea=function(){a.debug&&console.log("getLayers");for(var b in a.layers)"undefined"===typeof t[a.layers[b]]?
console.log("layer "+a.layers[b]+" not available"):(g[a.layers[b]]=t[a.layers[b]],0<b&&g[a.layers[b]].setVisible(!1));var c=[];for(b in g)c.push(g[b]);return c},fa=function(){a.debug&&console.log("createLayerSwitcher");$("#"+a.target+" .ol-viewport .ol-overlaycontainer-stopevent").append($("\x3cdiv\x3e").attr("class","p3d-layer-switcher btn-group switcher").attr("id",a.target+"-layer-switcher"));for(var b in a.layers)g[a.layers[b]].get("show")&&$("#"+a.target+" #"+a.target+"-layer-switcher").append($("\x3cbutton\x3e").attr("id",
"layer_switcher_"+a.layers[b]).attr("type","button").attr("class","btn btn-default").append($("\x3cspan\x3e").text(g[a.layers[b]].get("label"))));for(b in a.layers)$("#"+a.target+" #layer_switcher_"+a.layers[b]).click({id:a.layers[b]},ga)},O=function(){a.debug&&console.log("createLayerPopup");$("#"+a.target+" .ol-viewport .ol-overlaycontainer-stopevent").append($("\x3cdiv\x3e").attr("id",a.target+"_popup").attr("class","ol-popup").append($("\x3cdiv\x3e").attr("id",a.target+"_popup-content")))},ga=
function(b){a.debug&&console.log("switchBaseLayer");for(var l in g)l==b.data.id?getLayerById(c.map,l).setVisible(!0):getLayerById(c.map,l).setVisible(!1)},P=function(){a.debug&&console.log("createDetailPanel");$("#"+a.target+" .ol-viewport .ol-overlaycontainer-stopevent").append($("\x3cdiv\x3e").attr("id",a.target+"-detail-panel").attr("class","p3d-detail-panel"));$("#"+a.target+"-detail-panel").hide()},Q=function(){a.debug&&console.log("createLegendPanel");$("#"+a.target+" .ol-viewport .ol-overlaycontainer-stopevent").append($("\x3cdiv\x3e").attr("id",
a.target+"-legend-panel").attr("class","p3d-legend-panel"));$("#"+a.target+"-legend-panel").append($("\x3cdiv\x3e").attr("id",a.target+"-legend-panel-icon").attr("class","p3d-legend-panel-icon").append($("\x3ca\x3e").attr("id",a.target+"-legend-panel-closer").attr("class","p3d-legend-panel-closer").append($("\x3cimg\x3e").attr("src",a.imgpath+"imgs/layer-switcher-minimize.png"))));$("#"+a.target+"-legend-panel-closer").click(ha);$("#"+a.target+"-legend-panel").hide();$("#"+a.target+" .ol-viewport .ol-overlaycontainer-stopevent").append($("\x3cdiv\x3e").attr("id",
a.target+"-legend-panel-opener").attr("class","p3d-legend-panel-opener"));$("#"+a.target+"-legend-panel-opener").append($("\x3ca\x3e").append($("\x3cimg\x3e").attr("src",a.imgpath+"imgs/layer-switcher-maximize.png")));$("#"+a.target+"-legend-panel-opener a").click(W);$("#"+a.target+"-legend-panel-opener").hide()},W=function(){a.debug&&console.log("openLegend");$("#"+a.target+" #"+a.target+"-legend-panel").show();$("#"+a.target+" #"+a.target+"-legend-panel-opener").hide();$("#"+a.target+" #search-results-panel").is(":visible")&&
this.closeResults()},ha=function(){a.debug&&console.log("closeLegend");$("#"+a.target+" #"+a.target+"-legend-panel").hide();$("#"+a.target+" #"+a.target+"-legend-panel-opener").show()};this.createPanel=function(){a.debug&&console.log("createPanel");if(f)$("#"+a.target+" .ol-viewport .ol-overlaycontainer-stopevent").append($("\x3cdiv\x3e").attr("id",a.target+"-panel").attr("class","p3d-panel")),$("#"+a.target+"-panel").append($("\x3cdiv\x3e").attr("id",a.target+"-panel-icon").attr("class","p3d-panel-icon").append($("\x3ca\x3e").attr("id",
a.target+"-panel-closer").attr("class","p3d-panel-closer").append($("\x3cimg\x3e").attr("src",a.imgpath+"imgs/layer-switcher-minimize.png")))),$("#"+a.target+"-panel-closer").click(this.closePanel),$("#"+a.target+"-panel").hide(),$("#"+a.target+" .ol-viewport .ol-overlaycontainer-stopevent").append($("\x3cdiv\x3e").attr("id",a.target+"-panel-opener").attr("class","p3d-panel-opener")),$("#"+a.target+"-panel-opener").append($("\x3ca\x3e").append($("\x3cimg\x3e").attr("src",a.imgpath+"imgs/layer-switcher-maximize.png"))),
$("#"+a.target+"-panel-opener a").click(this.openPanel),$("#"+a.target+"-panel-opener").hide();else{var b=this;setTimeout(function(){b.createPanel()},500)}};this.openPanel=function(){a.debug&&console.log("openPanel");if(f)$("#"+a.target+" #"+a.target+"-panel").show(),$("#"+a.target+" #"+a.target+"-panel-opener").hide(),$("#"+a.target+" #search-results-panel").is(":visible")&&this.closeResults();else{var b=this;setTimeout(function(){b.openPanel()},500)}};this.closePanel=function(){a.debug&&console.log("closePanel");
if(f)$("#"+a.target+" #"+a.target+"-panel").hide(),$("#"+a.target+" #"+a.target+"-panel-opener").show();else{var b=this;setTimeout(function(){b.closePanel()},500)}};this.loadTematismi=function(b,l,h,e){a.debug&&console.log("loadTematismi");if(f){if(null==h||"undefined"===typeof h)h=!1;if(x){$("#"+a.target+" #"+a.target+"-legend-panel").remove();$("#"+a.target+" #"+a.target+"-legend-panel-opener").remove();G&&G.clear();for(var d in c.map.getLayers().getArray()){var k=c.map.getLayers().getArray()[d];
k.get("id").startsWithIgnorCase("tematismo_")&&(k.getSource().clear(),c.map.removeLayer(k))}}else P();Q();O();this.processTematismi(b,l,h,e)}else{var n=this;setTimeout(function(){n.loadTematismi(b,l,andor)},500)}};this.reloadTematismi=function(b,c,h,e){a.debug&&console.log("reloadTematismi");x=!0;this.loadTematismi(b,c,h,e)};this.loadTematismiCarto=function(b,l,h){a.debug&&console.log("loadTematismiCarto");var e=this;if(f){if(p(!0),z?($("#"+a.target+" #"+a.target+"-legend-panel").remove(),$("#"+a.target+
" #"+a.target+"-legend-panel-opener").remove()):P(),Q(),O(),A=l,M=h,null!==M&&(a.tematismi=M),null!==a.tematismi&&0!==a.tematismi.length){var N=A?A:null,k=!1;$.ajax({type:"GET",url:d.getServerUrl(a.protocol,a.server,a.webapp)+"/themecarto",async:!0,data:{json:JSON.stringify(a.tematismi),layer:N},dataType:"json",contentType:"application/x-www-form-urlencoded",beforeSend:function(b){if(this.url.length>c.requestMaxLength)return b.abort(),k=!0,console.log("Richiesta in GET a "+d.getServerUrl(a.protocol,
a.server,a.webapp)+"/themecarto troppo lunga, passo in POST"),!1},success:function(a){z&&($("#legend-items-container").empty(),$("#legend-items-container").remove());e.processTematismi(b,a,!1);p(!1)},error:function(a){console.log("Errore"+a);p(!1)}});k&&$.ajax({type:"POST",url:d.getServerUrl(a.protocol,a.server,a.webapp)+"/themecarto",async:!0,data:{json:JSON.stringify(a.tematismi)},dataType:"json",contentType:"application/x-www-form-urlencoded",success:function(a){z&&($("#legend-items-container").empty(),
$("#legend-items-container").remove());e.processTematismi(b,a,!1);p(!1)},error:function(a){console.log("Errore"+a);p(!1)}})}}else setTimeout(function(){e.loadTematismiCarto(b,l,h)},500)};this.reloadTematismiCarto=function(b,c,h){a.debug&&console.log("reloadTematismiCarto");z=!0;this.loadTematismiCarto(b,A,h)};this.getServiceArea=function(b){a.debug&&console.log("getServiceArea");if(f)p(!0),$.ajax({type:"GET",dataType:"json",url:d.getServerUrl(a.protocol,a.server,a.webapp)+"/service-area?x\x3d"+b.coordinate[0]+
"\x26y\x3d"+b.coordinate[0]+"\x26epsg\x3d"+c.map.getView().getProjection().getCode(),success:function(a){geomJson=a.geom;X(geomJson);p(!1)},error:function(a){console.log("Errore"+a);p(!1)}});else{var l=this;setTimeout(function(){l.getServiceArea(b)},500)}};var D=null;this.processTematismi=function(b,c,h,e){a.debug&&console.log("processTematismi");if(f){p(!0);if(null==c||0==c.length)alert("Nessuna informazione disponibile");else{D=c;$("#"+a.target+"-legend-panel").append($("\x3cdiv\x3e").attr("id",
"legend-items-container"));if("undefined"===typeof c.items)for(var d in c){var k=c[d],n=c[d].items?c[d].items:c,H="undefined"!==typeof c[d].checked?c[d].checked:!1;Y(d,k,n,H,b,h,e,"legend-items-container")}else{var g="legend-items-container",I=!1,n=!1;for(d in c.themes)if(c.themes[d].values)for(k=0;k<c.themes[d].values.length;k++)c.themes[d].values[k].color&&(n||($("#legend-items-container").append($("\x3cul\x3e").attr("id","myTab").attr("class","nav nav-tabs")),$("#myTab").append($("\x3cli\x3e").attr("class",
"active").append($("\x3ca\x3e").attr("href","#legend-tab-tematismi").attr("data-toggle","tab").text("Filtri"))),$("#myTab").append($("\x3cli\x3e").append($("\x3ca\x3e").attr("href","#legend-tab-legend").attr("data-toggle","tab").text("Legenda"))),$("#legend-items-container").append($("\x3cdiv\x3e").attr("id","legend-tab-container").attr("class","tab-content")),$("#legend-tab-container").append($("\x3cdiv\x3e").attr("id","legend-tab-tematismi").attr("class","tab-pane active").attr("style","padding-top: 3px;")),
$("#legend-tab-container").append($("\x3cdiv\x3e").attr("id","legend-tab-legend").attr("class","tab-pane").attr("style","padding-top: 3px;")),g=c.themes[d].title.alyLatinize().replaceAll(" ","-").replaceAll(" ","-").replaceAll("\x26nbsp;","y").replaceAll(".","").replaceAll(":",""),$("#legend-tab-legend").append($("\x3cdiv\x3e").text(g).attr("class","legend-elem").attr("style","padding-left: 2px; font-weight: bold;")),g="legend-tab-tematismi",I=n=!0),$("#legend-tab-legend").append($("\x3cdiv\x3e").attr("class",
"p3d-circle").attr("style","background: #"+c.themes[d].values[k].color)).append($("\x3cdiv\x3e").attr("class","legend-elem").attr("style","display: inline-block; padding-left: 5px;").text(c.themes[d].values[k].label)));I&&$("#legend-tab-legend").append($("\x3cdiv\x3e").attr("class","p3d-circle").attr("style","background: #1e8a7c")).append($("\x3cdiv\x3e").attr("class","legend-elem").attr("style","display: inline-block; padding-left: 5px;").text("Altri"));for(d in c.themes)k=c.themes[d],n=c.items,
H="undefined"!==typeof c.themes[d].checked?c.themes[d].checked:!1,Y(d,k,n,H,b,h,e,g,I)}$("#myTab a:first").tab("show");$("#myTab a").click(function(a){a.preventDefault();$(this).tab("show")});W()}$.unblockUI();p(!1)}else{var m=this;setTimeout(function(){m.processTematismi(b,c,h)},500)}};var Y=function(b,l,h,e,f,k,n,g,q){a.debug&&console.log("processSingleTematismo");var I=l.title.alyLatinize().replaceAll(" ","-").replaceAll(" ","-").replaceAll("\x26nbsp;","y").replaceAll(".","").replaceAll(":",""),
p="tematismo_"+I;ia(b,l,p,I,e,f,k,g,q);v[l.title]=l.values;b=ja(h,l);if(z)getLayerById(c.map,p).getSource().clear(),getLayerById(c.map,p).getSource().addFeatures(b);else{vectorSource=new ol.source.Vector({features:b});c.map.addLayer(new ol.layer.Vector({id:p,source:vectorSource,visible:!1,style:function(b){for(var c=0;c<v[b.get("tematismo")].length;c++){var l=v[b.get("tematismo")][c],h="undefined"!==typeof l.value&&l.value==b.get("valore_tema"),e="undefined"!==typeof l.where&&l.where==b.get("valore_tema"),
k="undefined"!==typeof l.from&&d.isNumeric(l.from)&&"undefined"!==typeof l.to&&d.isNumeric(l.to)&&parseFloat(l.from)<=parseFloat(b.get("valore_tema"))&&parseFloat(l.to)>=parseFloat(b.get("valore_tema")),f="undefined"!==typeof l.from&&"undefined"!==typeof l.to&&(!d.isNumeric(l.from)||!d.isNumeric(l.to));if(h||e||k)return m[b.get("tematismo")+l.label];a.debug&&f&&console.log("Attenzione, impossibile caricare il tematismo perchè non in formato numerico. Controllare i range di valori")}}}));K=new ol.interaction.Select({condition:ol.events.condition.pointerMove});
B=new ol.interaction.Select({condition:ol.events.condition.click});c.map.addInteraction(K);var r=new ol.Overlay({element:document.getElementById(a.target+"_popup"),autoPan:!0,autoPanAnimation:{duration:250}});c.map.addOverlay(r);K.on("select",function(b){if(1==b.target.getFeatures().getLength()){var c=b.selected[0];$("#"+a.target+"_popup").show();$("#"+a.target+"_popup-content").text(c.get("label")?c.get("label"):c.get("descrizione"));r.setPosition(b.mapBrowserEvent.coordinate)}else $("#"+a.target+
"_popup").is(":visible")&&$("#"+a.target+"_popup").hide()});c.map.addInteraction(B);B.on("select",function(b){$("#"+a.target+" #"+a.target+"-detail-panel").hide();if(1==b.target.getFeatures().getLength()&&f){$("#"+a.target+"-detail-panel").empty();if(n){var c,l;l=!1;var h,e;for(e in n){h="elem-single";if(n[e].type)if("title"===n[e].type)h="elem-title";else if("list"===n[e].type&&n[e].level){$("#"+a.target+"-detail-panel").append($("\x3cdiv\x3e").attr("class","elem-single bold").text(n[e].label));
h="elem-list";l=n[e].field.split(",");if(0<l.length){$("#"+a.target+"-detail-panel").append($("\x3cdiv\x3e").attr("class",h).append($("\x3ctable\x3e").attr("id","table-"+n[e].level)));var d=b.selected[0].get(n[e].level),k;for(k in d){$("#table-"+n[e].level).append($("\x3ctr\x3e").attr("id","table-tr-"+k));for(var g=0;g<l.length;g++)c=d[k][l[g]],c="boolean"===typeof c?!0===c?"si":"no":c,c="number"==typeof c?Z(c):c,$("#table-tr-"+k).append($("\x3ctd\x3e").text(c))}}l=!0}else alert("Tipo elemento "+
n[e].type+" non gestito");l||(c=b.selected[0].get(n[e].field),c="boolean"===typeof c?!0===c?"si":"no":c,c="number"==typeof c?Z(c):c,$("#"+a.target+"-detail-panel").append($("\x3cdiv\x3e").attr("class",h).append($("\x3cspan\x3e").attr("class","bold").text(n[e].label)).append($("\x3cspan\x3e").text(" "+c))))}}else $("#"+a.target+"-detail-panel").append($("\x3cspan\x3e").text(b.selected[0].get("label")?b.selected[0].get("label"):b.selected[0].get("descrizione")));$("#"+a.target+" #"+a.target+"-detail-panel").show();
f(b.selected[0])}})}},ia=function(b,l,h,e,d,k,f,g,m){a.debug&&console.log("createLegendItem");$("#"+g).append($("\x3cdiv\x3e").attr("id","legend-item_"+b));$("#legend-item_"+b).append($("\x3cdiv\x3e").attr("id","openclose_"+b).attr("style","display:inline"));f?($("#legend-item_"+b).append($("\x3cinput\x3e").attr("id","check_"+h).attr("level","first").attr("type","checkbox").attr("class","p3d-check-tematismo").prop("checked",d)),$("#check_"+h).change({id:h,tematismo:l,map:c.map,div_id:"#legend-item_"+
b,multi:f,callback:k},aa)):($("#legend-item_"+b).append($("\x3cinput\x3e").attr("id","radio_"+h).attr("name","radio_tematismi").attr("level","first").attr("type","radio").attr("class","p3d-check-tematismo").prop("checked",!1)),$("#radio_"+h).change({id:h,tematismo:l,map:c.map,div_id:"#legend-item_"+b,multi:f,callback:k},aa));$("#legend-item_"+b).append($("\x3cspan\x3e").text(e));$("#openclose_"+b).append($("\x3cinput\x3e").attr("id","legend-item_"+b+"_open").attr("type","button").attr("class","openclose myopen").click({key:b},
function(b){a.debug&&console.log("open");$("#legend-item_"+b.data.key+"_content").show();$("#legend-item_"+b.data.key+"_open").hide();$("#legend-item_"+b.data.key+"_close").show()}));$("#openclose_"+b).append($("\x3cinput\x3e").attr("id","legend-item_"+b+"_close").attr("type","button").attr("class","openclose myclose").click({key:b},function(b){a.debug&&console.log("close");$("#legend-item_"+b.data.key+"_content").hide();$("#legend-item_"+b.data.key+"_open").show();$("#legend-item_"+b.data.key+"_close").hide()}));
$("#legend-item_"+b).append($("\x3cdiv\x3e").attr("id","legend-item_"+b+"_content"));$("#legend-item_"+b+"_content").append($("\x3cdiv\x3e").attr("id","all-none-div_"+h));$("#legend-item_"+b+"_content").hide();$("#legend-item_"+b+"_close").hide();$("#all-none-div_"+h).attr("style","margin-left: 15px;").append($("\x3ca\x3e").prop("disabled",!0).attr("id","show-all"+h).attr("class","disabled").text("Mostra tutti").click({layer_id:h,map:c.map,div_id:"#legend-item_"+b,tematismo:l,op:"show",multi:f,callback:k},
ba)).append($("\x3cspan\x3e").text(" / ")).append($("\x3ca\x3e").prop("disabled",!0).attr("id","hide-all"+h).attr("class","disabled").text("Nascondi tutti").click({layer_id:h,map:c.map,div_id:"#legend-item_"+b,tematismo:l,op:"hide",multi:f,callback:k},ba));for(e=0;e<l.values.length;e++)$("#legend-item_"+b+"_content").append($("\x3cdiv\x3e").attr("id","legend-item-value_"+b+"_"+e)),$("#legend-item-value_"+b+"_"+e).append($("\x3cinput\x3e").attr("id","check_"+b+"_"+e).attr("level","second").attr("parent",
h).attr("index",e).attr("type","checkbox").attr("style","margin-left: 20px; vertical-align: top;").prop("checked","undefined"!==typeof l.values[e].checked?l.values[e].checked:d).prop("disabled",!0)),l.values[e].color&&(m||$("#legend-item-value_"+b+"_"+e).append($("\x3cdiv\x3e").attr("class","p3d-circle").attr("style","background: #"+l.values[e].color))),$("#check_"+b+"_"+e).change({check_id:"#check_"+b+"_"+e,layer_id:h,tematismo:l,map:c.map,parameters:l.values[e],multi:f,callback:k},ka),l.values[e].label=
l.values[e].label.replace("@from@",l.values[e].from).replace("@to@",l.values[e].to),$("#legend-item-value_"+b+"_"+e).append($("\x3cdiv\x3e").attr("style","display: inline-block; width: 200px; padding-left: 5px;").text(l.values[e].label));$("#check_"+h).is(":checked")&&($("#show-all"+h).removeAttr("class","disabled"),$("#hide-all"+h).removeAttr("class","disabled"),$("#check_"+h).prop("checked",!1),$("#check_"+h).click())},ka=function(b){a.debug&&console.log("changeStyleItemVisibility");var c=b.data.tematismo;
if(b.data.multi){var h=b.data.check_id,c=b.data.layer_id;if(!$(h).is(":checked")){for(var e=h.substring(7,h.lastIndexOf("_")),h=h.substring(h.lastIndexOf("_")+1),f="undefined"===typeof D.items?D[e].values:D.themes[e].values,k=!1,n=0;n<f.length;n++)if($("#check_"+e+"_"+n).is(":checked")&&n!=h){k=!0;break}if(!k){$("#check_"+c).prop("checked",!1);for(n=0;n<f.length;n++)$("#check_"+e+"_"+n).prop("disabled",!0);$("#show-all"+c).prop("class","disabled");$("#hide-all"+c).prop("class","disabled")}}R(D,b.data.callback)}else{var e=
getLayerById(b.data.map,b.data.layer_id).getSource().getFeatures(),h=b.data.parameters.value,f=b.data.parameters.where,k=b.data.parameters.from,n=b.data.parameters.to,g=b.data.parameters.label;if($(b.data.check_id).is(":checked"))for(b=0;b<e.length;b++){var p="undefined"!==typeof h&&h==e[b].get("valore_tema"),q="undefined"!==typeof f&&f==e[b].get("valore_tema"),r="undefined"!==typeof k&&d.isNumeric(k)&&"undefined"!==typeof n&&d.isNumeric(n)&&parseFloat(k)<=parseFloat(e[b].get("valore_tema"))&&parseFloat(n)>=
parseFloat(e[b].get("valore_tema"));(p||q||r)&&e[b].setStyle(m[c.title+g])}else for(b=0;b<e.length;b++)p="undefined"!==typeof h&&h==e[b].get("valore_tema"),q="undefined"!==typeof f&&f==e[b].get("valore_tema"),r="undefined"!==typeof k&&d.isNumeric(k)&&"undefined"!==typeof n&&d.isNumeric(n)&&parseFloat(k)<=parseFloat(e[b].get("valore_tema"))&&parseFloat(n)>=parseFloat(e[b].get("valore_tema")),(p||q||r)&&e[b].setStyle(V[e[b].getGeometry().getType()])}},ba=function(b){a.debug&&console.log("showOrHideAll");
var c=b.data.div_id;"show"==b.data.op?$("input",$(c)).each(function(){"p3d-check-tematismo"!==$(this)[0].className&&$(this).prop("checked",!0)}):$("input",$(b.data.div_id)).each(function(){"p3d-check-tematismo"!==$(this)[0].className&&$(this).prop("checked",!1)});if(b.data.multi)R(D,b.data.callback);else if(c=getLayerById(b.data.map,b.data.layer_id).getSource().getFeatures(),"show"==b.data.op)for(var h=0;h<c.length;h++)for(var e=c[h],f=0;f<v[b.data.tematismo.title].length;f++){var k=v[b.data.tematismo.title][f],
n="undefined"!==typeof k.value&&k.value==e.get("valore_tema"),g="undefined"!==typeof k.where&&k.where==e.get("valore_tema"),p="undefined"!==typeof k.from&&d.isNumeric(k.from)&&"undefined"!==typeof k.to&&d.isNumeric(k.to)&&parseFloat(k.from)<=parseFloat(e.get("valore_tema"))&&parseFloat(k.to)>=parseFloat(e.get("valore_tema")),q="undefined"!==typeof k.from&&"undefined"!==typeof k.to&&(!d.isNumeric(k.from)||!d.isNumeric(k.to));n||g||p?c[h].setStyle(m[b.data.tematismo.title+k.label]):a.debug&&q&&console.log("Attenzione, impossibile caricare il tematismo perchè non in formato numerico. Controllare i range di valori")}else for(h=
0;h<c.length;h++)c[h].setStyle(V[c[h].getGeometry().getType()])};this.loadTematismiAree=function(b,c){a.debug&&console.log("loadTematismiAree");var h=this;f?(p(!0),P(),Q(),O(),this.processTematismi(c,b),p(!1)):setTimeout(function(){h.loadTematismiAree()},500)};var aa=function(b){a.debug&&console.log("switchTheme");$("input[type\x3dcheckbox]",$(b.data.div_id)).each(function(){"p3d-check-tematismo"!==$(this)[0].className&&$(this).prop("disabled",!$((b.data.multi?"#check_":"#radio_")+b.data.id).is(":checked"))});
if($((b.data.multi?"#check_":"#radio_")+b.data.id).is(":checked")){$("#"+a.target+" #show-all"+b.data.id).removeAttr("class","disabled");$("#"+a.target+" #hide-all"+b.data.id).removeAttr("class","disabled");for(var c=b.data.div_id.substring(b.data.div_id.lastIndexOf("_")+1),h="undefined"===typeof D.items?D[c].values:D.themes[c].values,e=!0,d=0;d<h.length;d++)if($("#check_"+c+"_"+d).is(":checked")){e=!1;break}if(e)for(d=0;d<h.length;d++)$("#check_"+c+"_"+d).prop("checked",!0)}else $("#"+a.target+" #show-all"+
b.data.id).attr("class","disabled"),$("#"+a.target+" #hide-all"+b.data.id).attr("class","disabled");if(b.data.multi)R(D,b.data.callback);else{for(c in b.data.map.getLayers().getArray())h=b.data.map.getLayers().getArray()[c],h.get("id").startsWithIgnorCase("tematismo_")&&h.setVisible(!1);getLayerById(b.data.map,b.data.id).setVisible($("#radio_"+b.data.id).is(":checked"))}},S=function(a){return a.geom?c.geojson.readGeometry(a.geom):new ol.geom.Point(ol.proj.transform([a.lon,a.lat],"EPSG:4326",c.map.getView().getProjection().getCode()))};
this.refreshSelection=function(b){a.debug&&console.log("refreshSelection");c.map.removeLayer(E);this.createSelection(b,s,void 0,y)};this.createSelection=function(b,d,h,e){a.debug&&console.log("createSelection");if(f){p(!0);inputObject=b;y=e;s=d;u=new ol.source.Vector;E=new ol.layer.Vector({source:u,style:function(a){return new ol.style.Style({fill:new ol.style.Fill({color:a.get("color")?a.get("color"):"rgba(57, 210, 48, 0.6)"}),stroke:new ol.style.Stroke({color:a.get("color")?a.get("color"):"rgba(57, 210, 48, 0.6)",
width:1}),text:new ol.style.Text({text:a.get("name")?a.get("name"):"",scale:1.3,fill:new ol.style.Fill({color:a.get("color")?a.get("color"):"rgba(57, 210, 48, 0.6)"}),stroke:new ol.style.Stroke({color:"#FFFFFF",width:3.5})})})}});c.map.addLayer(E);h&&this.addSelectButtons();var g=getLayerById(c.map,s).getSource(),k=g.params_.FIELDFILTER,n="",H={},q={};if("undefined"!==typeof b&&null!=b){for(var m=0;m<b.length;m++){n+=" '"+b[m][k]+"' ,";if(b[m].label||b[m].RefId)H[b[m][k]]=b[m].label?b[m].label+(b[m].RefId?
"-"+b[m].RefId:""):b[m].RefId?b[m].RefId:"";q[b[m][k]]=b[m].color}n=n.substring(0,n.length-1);n=ca(g,n);$.ajax({type:"GET",url:n,async:!1,success:function(a){if("undefined"===typeof a.features||0==a.features.length)console.log("nessun oggetto disponibile per la selezione (è necessario passare un array di JSON ciascuno con catid composto da comune, foglio e mappale, rispettivamente di 4, 4 e 8 caratteri)");else{var b=a.crs.properties.name.split("EPSG::")[1];a=(new ol.format.GeoJSON).readFeatures(a);
for(var d in a){a[d].getGeometry().transform("EPSG:"+b,epsg);null==a[d].get("name")&&a[d].setProperties({name:H[a[d].get(k)]});var e=ol.color.asArray(q[a[d].get(k)]),e=e.slice();e[3]=.6;a[d].setProperties({color:e})}u.addFeatures(a);c.map.getView().fit(u.getExtent(),c.map.getSize())}p(!1)}})}B=new ol.interaction.Select({condition:ol.events.condition.click});var r=function(a){return new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.6)"}),stroke:new ol.style.Stroke({color:a.get("color")?
a.get("color"):"rgba(57, 210, 48, 0.6)",width:1}),text:new ol.style.Text({text:a.get("name"),scale:1.3,fill:new ol.style.Fill({color:a.get("color")?a.get("color"):"rgba(57, 210, 48, 0.6)"}),stroke:new ol.style.Stroke({color:"#FFFFFF",width:3.5})})})};h||(c.map.addInteraction(B),B.on("select",function(a){1==a.target.getFeatures().getLength()&&(E.getSource().getFeatures().forEach(function(b){b.setStyle(null);b.get(g.params_.FIELDFILTER)==a.selected[0].get(g.params_.FIELDFILTER)&&b.setStyle(r(b))}),
y(a.selected[0]))}));p(!1)}else{var t=this;setTimeout(function(){t.createSelection(b,d,h,e)},500)}};var ca=function(b,d){a.debug&&console.log("buildWfsCall");var h=b.urls[0].replace("wms","wfs")+"?service\x3dwfs\x26version\x3d2.0.0\x26request\x3dGetFeature\x26";return h+="typeNames\x3d"+b.params_.PREFIX+":"+b.params_.LAYERS+"\x26"+("cql_filter\x3d"+b.params_.FIELDFILTER+" IN ("+d+")")+"\x26"+("outputformat\x3d"+c.strApplicationJson)};this.createVeil=function(b){a.debug&&console.log("createVeil");
if(f){p(!0);J=new ol.source.Vector;F=new ol.layer.Vector({id:"veil",source:J,style:function(a){return new ol.style.Style({fill:new ol.style.Fill({color:a.get("color")?a.get("color"):"rgba(255, 255, 255, 0.6)"}),stroke:new ol.style.Stroke({color:a.get("color")?a.get("color"):"#319FD3",width:1}),text:new ol.style.Text({text:a.get("name"),scale:1.3,fill:new ol.style.Fill({color:a.get("color")?a.get("color"):"#319FD3"}),stroke:new ol.style.Stroke({color:"#FFFFFF",width:3.5})})})}});c.map.addLayer(F);
var l=[],h={},e={};if("undefined"!==typeof b&&0<b.length){for(var g=0;g<b.length;g++)l.push(b[g].geoid),h[b[g].geoid]=b[g].label+"-"+b[g].RefId,e[b[g].geoid]=b[g].color;var l=$.ajax({type:"GET",url:d.getServerUrl(a.protocol,a.server,a.webapp)+"/read",async:!1,data:{filter:JSON.stringify(l)},dataType:"json"}).responseText,l=(new ol.format.GeoJSON).readFeatures(l),k;for(k in l)g=ol.color.asArray(e[l[k].get("geoid")]),g=g.slice(),g[3]=.6,l[k].setProperties({name:h[l[k].get("geoid")],color:g});getLayerById(c.map,
"veil").getSource().addFeatures(l)}p(!1)}else{var n=this;setTimeout(function(){n.createVeil(b)},500)}};this.activateVeilSelect=function(b){a.debug&&console.log("activateVeilSelect");if(f)B=new ol.interaction.Select({condition:ol.events.condition.click}),c.map.addInteraction(B),B.on("select",function(a){1==a.target.getFeatures().getLength()&&b(a.selected[0])});else{var d=this;setTimeout(function(){d.activateVeilSelect(b)},500)}};this.displayControlsVeilDraw=function(b){a.debug&&console.log("displayControlsVeilDraw");
if(f)0==$("#"+a.target+" #"+a.target+"-draw-switcher").length&&$("#"+a.target+" .ol-viewport .ol-overlaycontainer-stopevent").append($("\x3cdiv\x3e").attr("class","p3d-draw-switcher btn-group switcher").attr("id",a.target+"-draw-switcher")),$("#"+a.target+" #"+a.target+"-draw-switcher").append($("\x3cbutton\x3e").attr("id","start-draw").attr("type","button").attr("class","btn btn-default").append($("\x3cspan\x3e").text("Inizia"))),$("#"+a.target+" #"+a.target+"-draw-switcher").append($("\x3cbutton\x3e").attr("id",
"end-draw").attr("type","button").attr("class","btn btn-default").append($("\x3cspan\x3e").text("Termina"))),$("#"+a.target+" #"+a.target+"-draw-switcher").append($("\x3cbutton\x3e").attr("id","delete-draw").attr("type","button").attr("class","btn btn-default").append($("\x3cspan\x3e").text("Elimina"))),$("#"+a.target+" #"+a.target+"-draw-switcher").append($("\x3cbutton\x3e").attr("id","clear-draw").attr("type","button").attr("class","btn btn-default").append($("\x3cspan\x3e").text("Annulla"))),$("#"+
a.target+" #start-draw").click(this.activateVeilDraw),$("#"+a.target+" #end-draw").click({callback:b},this.persistVeilDraw),$("#"+a.target+" #delete-draw").click(this.deleteVeilDraw),$("#"+a.target+" #clear-draw").click({target:this},this.deactivateVeilDraw);else{var c=this;setTimeout(function(){c.displayControlsVeilDraw(b)},500)}};this.displayButton=function(b,c){a.debug&&console.log("displayButton");if(f)0==$("#"+a.target+" #"+a.target+"-draw-switcher").length&&$("#"+a.target+" .ol-viewport .ol-overlaycontainer-stopevent").append($("\x3cdiv\x3e").attr("class",
"p3d-draw-switcher btn-group switcher").attr("id",a.target+"-draw-switcher")),$("#"+a.target+" #"+a.target+"-draw-switcher").append($("\x3cbutton\x3e").attr("id",b.id).attr("type","button").attr("class","btn btn-default").append($("\x3cspan\x3e").text(b.text))),$("#"+a.target+" #"+b.id).click({callback:b.callback},c);else{var d=this;setTimeout(function(){d.displayButton(b,c)},500)}};this.activateVeilDraw=function(b){a.debug&&console.log("activateVeilDraw");c.map.removeInteraction(C);c.map.removeInteraction(w);
C=new ol.interaction.Draw({source:getLayerById(c.map,"veil").getSource(),type:"Polygon"});c.map.addInteraction(C)};var la=function(b){a.debug&&console.log("retrieveCallbackFunction");return"click"==b.type?b.data.callback:b};this.persistVeilDraw=function(b){a.debug&&console.log("persistVeilDraw");p(!0);for(var l=getLayerById(c.map,"veil").getSource().getFeatures(),l=c.geojson.writeFeatures(l),l=JSON.parse(l),h=0;h<l.features.length;h++)l.features[h].properties&&(delete l.features[h].properties.name,
delete l.features[h].properties.color);var l=JSON.stringify(l),l=l.replaceAll('"properties":null','"properties":{"geoid":-1}'),e=!1,h=$.ajax({type:"GET",url:d.getServerUrl(a.protocol,a.server,a.webapp)+"/write",async:!1,data:{geoms:l},dataType:"json",contentType:"application/x-www-form-urlencoded",beforeSend:function(b){if(this.url.length>c.requestMaxLength)return b.abort(),e=!0,console.log("Richiesta in GET a "+d.getServerUrl(a.protocol,a.server,a.webapp)+"/write troppo lunga, passo in POST"),!1}}).responseText;
e&&(h=$.ajax({type:"POST",url:d.getServerUrl(a.protocol,a.server,a.webapp)+"/write",async:!1,data:{geoms:l},dataType:"json",contentType:"application/x-www-form-urlencoded"}).responseText);c.map.removeInteraction(C);c.map.removeInteraction(w);la(b)(h);p(!1)};this.deleteVeilDraw=function(b){a.debug&&console.log("deleteVeilDraw");c.map.removeInteraction(C);w=new ol.interaction.Select({condition:ol.events.condition.click});c.map.addInteraction(w);w.on("select",function(a){1==a.target.getFeatures().getLength()&&
getLayerById(c.map,"veil").getSource().removeFeature(a.target.getFeatures().array_[0])})};this.deactivateVeilDraw=function(b){a.debug&&console.log("deactivateVeilDraw");c.map.removeInteraction(C);c.map.removeInteraction(w);getLayerById(c.map,"veil").getSource().clear();a.debug&&console.log("clearAllInteractions");B&&c.map.removeInteraction(B);K&&c.map.removeInteraction(K);C&&c.map.removeInteraction(C);w&&c.map.removeInteraction(w);boxControl&&c.map.removeInteraction(boxControl);onClick&&c.map.unByKey(onClick)};
this.addSelectButtons=function(){a.debug&&console.log("addSelectButtons");$("#"+a.target+" #"+a.target+"-layer-switcher").append($("\x3cdiv\x3e").attr("class","btn-group switcher").attr("id",a.target+"-sel-switcher").attr("style","float: right; padding-left: 40px;"));$("#"+a.target+" #"+a.target+"-sel-switcher").append($("\x3cbutton\x3e").attr("id","start-selection").attr("value","Attiva").attr("type","button").attr("class","btn btn-default").append($("\x3cspan\x3e").text("Seleziona")));$("#"+a.target+
" #"+a.target+"-sel-switcher").append($("\x3cbutton\x3e").attr("id","end-selection").attr("value","Disattiva").attr("type","button").attr("class","btn btn-default").append($("\x3cspan\x3e").text("Termina")));$("#"+a.target+" #"+a.target+"-sel-switcher").append($("\x3cbutton\x3e").attr("id","clear-selection").attr("value","Disattiva").attr("type","button").attr("class","btn btn-default").append($("\x3cspan\x3e").text("Annulla")));$("#"+a.target+" #start-selection").click({layerSelectableId:s,target:this},
this.addLayerSelection);$("#"+a.target+" #end-selection").click({layerSelectableId:s,callback:y},this.removeLayerSelection);$("#"+a.target+" #clear-selection").click({},this.clearLayerSelection)};this.addLayerSelection=function(b){a.debug&&console.log("addLayerSelection");b.data.target.activateClick(function(a){p(!0);p(!0);var d=getLayerById(c.map,b.data.layerSelectableId).getSource(),e=d.getGetFeatureInfoUrl(a.coordinate,r.getResolution(),epsg,{INFO_FORMAT:"application/json"});e&&$.ajax({url:e,type:"GET"}).done(function(b){var c=
(new ol.format.GeoJSON).readFeatures(b);b=b.crs.properties.name.split("EPSG::")[1];c[0].getGeometry().transform("EPSG:"+b,epsg);a.originalEvent.ctrlKey?(p(!1),E.getSource().getFeatures().forEach(function(a){a.get(d.params_.FIELDFILTER)==c[0].get(d.params_.FIELDFILTER)&&u.removeFeature(a)})):(b=ca(d,"'"+c[0].get(d.params_.FIELDFILTER)+"'"),$.ajax({type:"GET",url:b,async:!1,success:function(a){var b=(new ol.format.GeoJSON).readFeatures(a),d=a.crs.properties.name.split("EPSG::")[1];b.forEach(function(a){a.getGeometry().transform("EPSG:"+
d,epsg)});0!==b.length?u.addFeatures(b):u.addFeatures(c);p(!1)}}))});p(!1)})};this.getFeatureInfo=function(b,c,d){a.debug&&console.log("getFeatureInfo");if(f){p(!0);var e=b.getSource().getGetFeatureInfoUrl(c,r.getResolution(),epsg,{INFO_FORMAT:"application/json"});e&&$.ajax({url:e,type:"GET"}).done(function(a){var b=new ol.format.GeoJSON;d(b.readFeatures(a))});p(!1)}else setTimeout(function(){getFeatureInfo(b,c)},500)};this.removeLayerSelection=function(b){a.debug&&console.log("removeLayerSelection");
var d=E.getSource().getFeatures(),h=getLayerById(c.map,b.data.layerSelectableId).getSource().params_.FIELDFILTER,e=[];d.forEach(function(a){var c={},d=!1;c[h]=a.get(h);c.type=b.data.layerSelectableId;for(var l in e)if(e[l][h]==c[h]){d=!0;break}d||e.push(c)});onClick&&c.map.unByKey(onClick);b.data.callback(JSON.stringify(e))};this.clearLayerSelection=function(b){a.debug&&console.log("clearLayerSelection");onClick&&c.map.unByKey(onClick);E.getSource().clear()};this.loadKml=function(b){a.debug&&console.log("loadKml");
if(f){var d=new ol.layer.Vector({source:new ol.source.Vector({url:b,format:new ol.format.KML})});c.map.addLayer(d)}else{var h=this;setTimeout(function(){h.loadKml(b)},500)}};var X=function(b){a.debug&&console.log("processGeom");if(f){p(!0);var d=[],h=c.geojson.readGeometry(b,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}),h=new ol.Feature({geometry:h});d.push(h);d=new ol.source.Vector({features:d});d=new ol.layer.Vector({source:d,style:[new ol.style.Style({stroke:new ol.style.Stroke({color:"rgba(0, 204, 153, 1)",
width:1}),fill:new ol.style.Fill({color:"rgba(0, 204, 153, 0.5)"})})]});c.map.addLayer(d);p(!1)}else setTimeout(function(){X(b)},500)};this.zoomToExtent=function(b,d,h,e){a.debug&&console.log("zoomToExtent");if(f){p(!0);var g=ol.extent.boundingExtent([[b,d],[h,e]]);c.map.getView().fit(g,c.map.getSize());p(!1)}else{var k=this;setTimeout(function(){k.zoomToExtent(b,d,h,e)},500)}};this.zoomToCenter=function(b,d,h){a.debug&&console.log("zoomToCenter");if(f){p(!0);var e=[b,d];c.map.getView().setCenter(e);
c.map.getView().setZoom(h);p(!1)}else{var g=this;setTimeout(function(){g.zoomToCenter(b,d,h)},500)}};this.zoomToLatLon=function(b,c,d){a.debug&&console.log("zoomToLatLon");b=S({lon:c,lat:b});this.zoomToCenter(b.getCoordinates()[0],b.getCoordinates()[1],d)};this.activateRectangularSelection=function(b){a.debug&&console.log("activateRectangularSelection");if(f)"undefined"===typeof boxControl&&(boxControl=new ol.interaction.DragBox({style:new ol.style.Style({stroke:new ol.style.Stroke({color:[250,25,
25,1]})})})),c.map.addInteraction(boxControl),boxControl.on("boxend",function(){var a=[],c=this.getGeometry().getExtent();markerLayer.getSource().forEachFeatureIntersectingExtent(c,function(b){a.push(b)});var d=new Set,f;for(f in a)d.add(a[f].getId());var l=[];existentMarkers.forEach(function(a){d.has(a.id)&&l.push(a)});b(l)});else{var d=this;setTimeout(function(){d.activateRectangularSelection(b)},500)}};this.disactivateRectangularSelection=function(){a.debug&&console.log("disactivateRectangularSelection");
if(f)boxControl&&c.map.removeInteraction(boxControl);else{var b=this;setTimeout(function(){b.disactivateRectangularSelection()},500)}};this.activateClick=function(b){a.debug&&console.log("activateClick");if(f)onClick=c.map.on("singleclick",function(a){b(a)});else{var d=this;setTimeout(function(){d.activateClick(b)},500)}};this.deactivateClick=function(){a.debug&&console.log("deactivateClick");if(f)onClick&&c.map.unByKey(onClick);else{var b=this;setTimeout(function(){b.deactivateClick()},500)}};this.identifyMarkers=
function(b){a.debug&&console.log("identifyMarkers");if(f){var c=[];markerLayer.getSource().forEachFeatureIntersectingExtent(b,function(a){c.push(a)});return c}var d=this;setTimeout(function(){d.identifyMarkers(b)},500)};this.removeMarkers=function(b){a.debug&&console.log("removeMarkers");if(f)for(var c in b){var d=b[c];existentMarkers.has(d)&&existentMarkers["delete"](d);(d=markerLayer.getSource().getFeatureById(d.id))&&null!==d&&markerLayer.getSource().removeFeature(d)}else{var e=this;setTimeout(function(){e.removeMarkers(b)},
500)}};this.addMarkers=function(b){a.debug&&console.log("addMarkers");if(f)if(0==b.length)alert("Nessun marker disponibile"),$.unblockUI();else{"undefined"===typeof existentMarkers&&(existentMarkers=new Set);"undefined"===typeof markerSource&&(markerSource=new ol.source.Vector);"undefined"===typeof markerLayer&&(markerLayer=new ol.layer.Vector({source:markerSource}),c.map.addLayer(markerLayer));var d=[],h;for(h in b){var e=b[h];existentMarkers.add(e);var g=new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform([e.lon,
e.lat],"EPSG:4326",c.map.getView().getProjection().getCode()))});g.setId(e.id);var k=parseInt(e.color.substr(0,2),16),n=parseInt(e.color.substr(2,2),16),m=parseInt(e.color.substr(4,2),16),n=[k,n,m],k=new ol.style.Stroke({color:"black",width:2}),n=new ol.style.Fill({color:n}),e=new ol.style.Style({image:new ol.style.RegularShape({fill:n,stroke:k,points:3,radius:e.size,rotation:Math.PI/4,angle:0})});g.setStyle(e);d.push(g)}markerLayer.getSource().addFeatures(d)}else{var q=this;setTimeout(function(){q.addMarkers(b)},
500)}};this.addLayer=function(b){a.debug&&console.log("addLayer");if(f)c.map.addLayer(b);else{var d=this;setTimeout(function(){d.addLayer(b)},500)}};this.removeLayer=function(b){a.debug&&console.log("removeLayer");if(f)c.map.removeLayer(b);else{var d=this;setTimeout(function(){d.removeLayer(b)},500)}};this.getLayer=function(b){a.debug&&console.log("getLayer");if(f)return getLayerById(c.map,b);var d=this;setTimeout(function(){d.getLayer(b)},500)};this.updateSize=function(){a.debug&&console.log("updateSize");
c.map.updateSize()};var G=void 0,R=function(b,f){a.debug&&console.log("displayJoinedFeatures");var h=[];$("#legend-items-container input:checked").each(function(){"disabled"!==$(this).attr("disabled")&&h.push($(this))});var e=new Set,g=void 0,k;for(k in h){var n=h[k],m=n.attr("level");if("first"==m)g&&e.add(g),g=new Set;else if("second"==m)if("undefined"===typeof b.items)for(var q in b){var p=b[q],m=p.items,r=p.values,t="tematismo_"+p.title.alyLatinize().replaceAll(" ","-").replaceAll(" ","-").replaceAll("\x26nbsp;",
"y").replaceAll(".","").replaceAll(":","");if(t==n.attr("parent")){var m=m.map(function(b){var c=r[n.attr("index")],e="undefined"!==typeof c.value&&c.value==b.valore_tema,f="undefined"!==typeof c.where&&c.where==b.valore_tema,h="undefined"!==typeof c.from&&d.isNumeric(c.from)&&"undefined"!==typeof c.to&&d.isNumeric(c.to)&&parseFloat(c.from)<=parseFloat(b.valore_tema)&&parseFloat(c.to)>=parseFloat(b.valore_tema),c="undefined"!==typeof c.from&&"undefined"!==typeof c.to&&(!d.isNumeric(c.from)||!d.isNumeric(c.to));
if(e||f||h)return b.assetid;a.debug&&c&&console.log("Attenzione, impossibile caricare il tematismo perchè non in formato numerico. Controllare i range di valori");return null}),s;for(s in m)null===m[s]||g.has(m[s])||g.add(m[s])}}else for(q in b.themes)if(p=b.themes[q],m=b.items,r=p.values,t="tematismo_"+p.title.alyLatinize().replaceAll(" ","-").replaceAll(" ","-").replaceAll("\x26nbsp;","y").replaceAll(".","").replaceAll(":",""),t==n.attr("parent"))for(s in m=m.map(function(b){var c=r[n.attr("index")],
e=[],f=p.field;if(-1==f.indexOf("."))e.push(b[f]);else{var h=f.indexOf("."),g=b[f.substr(0,h)],k;for(k in g)e.push(g[k][f.substr(h+1,f.length)])}for(var l in e){g=e[l];f="undefined"!==typeof g&&g==c.value;h="undefined"!==typeof g&&g==c.where;g="undefined"!==typeof c.from&&d.isNumeric(c.from)&&"undefined"!==typeof c.to&&d.isNumeric(c.to)&&parseFloat(c.from)<=parseFloat(g)&&parseFloat(c.to)>=parseFloat(g);k="undefined"!==typeof c.from&&"undefined"!==typeof c.to&&(!d.isNumeric(c.from)||!d.isNumeric(c.to));
if(f||h||g)return b.assetid;a.debug&&k&&console.log("Attenzione, impossibile caricare il tematismo perchè non in formato numerico. Controllare i range di valori")}return null}),m)null===m[s]||g.has(m[s])||g.add(m[s])}g&&e.add(g);g=null;m=e.values();for(e=null;e=m.next().value;)null!==e&&0<e.size&&(g=null==g?e:g.intersection(e));G&&G.clear();m=null;if("undefined"===typeof b.items){var e={value:-1,index:-1},u;for(u in b)-1==e.value?(e.value=b[u].items.length,e.index=u):e<b[u].items.length&&(e.value=
b[u].items.length,e.index=u);m=b[e.index].items}else m=b.items;if(null!==g){k=[];for(u in m)e=m[u],g.has(e.assetid)&&(e.geometry=S(e),k.push(new ol.Feature(e)));G=new ol.source.Vector({features:k});c.map.addLayer(new ol.layer.Vector({id:"andor",source:G,style:function(a){return(a=a.get("color"))?new ol.style.Style({image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:"rgba(10, 10, 10, 1)",width:1}),fill:new ol.style.Fill({color:0==a.indexOf("#")?a:"#"+a})})}):new ol.style.Style({image:new ol.style.Circle({radius:5,
stroke:new ol.style.Stroke({color:"rgba(10, 10, 10, 1)",width:1}),fill:new ol.style.Fill({color:"rgba(0, 204, 153, 0.5)"})})})}}))}},ja=function(b,c){a.debug&&console.log("getFeaturesByTematismo");for(var f=[],e=0;e<b.length;e++){b[e].geometry=S(b[e]);b[e].tematismo=c.title;for(var g=0;g<c.values.length;g++){var k=c.values[g],n="undefined"!==typeof k.value&&k.value==b[e][c.field],p="undefined"!==typeof k.where&&k.where==b[e][c.field],q="undefined"!==typeof k.from&&d.isNumeric(k.from)&&"undefined"!==
typeof k.to&&d.isNumeric(k.to)&&parseFloat(k.from)<=parseFloat(b[e][c.field])&&parseFloat(k.to)>=parseFloat(b[e][c.field]),r="undefined"!==typeof k.from&&"undefined"!==typeof k.to&&(!d.isNumeric(k.from)||!d.isNumeric(k.to));if(k.color&&(n||p||q)){b[e].color=k.color;break}else a.debug&&r&&console.log("Attenzione, impossibile caricare il tematismo perchè non in formato numerico. Controllare i range di valori")}n=new ol.Feature(b[e]);f.push(n);for(g=0;g<v[n.get("tematismo")].length;g++)k=v[n.get("tematismo")][g],
"undefined"===typeof m[n.get("tematismo")+k.label]&&"undefined"!==typeof k.color&&(null==k.color&&(k.color="444444"),p=parseInt(k.color.substr(0,2),16)+parseInt(k.color.substr(2,2),16)+parseInt(k.color.substr(4,2),16),p="Point"==n.getGeometry().getType()?new ol.style.Style({image:new ol.style.Circle({radius:parseFloat(.6*k.size),stroke:new ol.style.Stroke({color:127<p/3?"#000":"#FFF"}),fill:new ol.style.Fill({color:0==k.color.indexOf("#")?k.color:"#"+k.color})})}):new ol.style.Style({stroke:new ol.style.Stroke({color:0==
k.color.indexOf("#")?k.color:"#"+k.color,width:1}),fill:new ol.style.Fill({color:0==k.color.indexOf("#")?k.color:"#"+k.color})}),m[n.get("tematismo")+k.label]=p)}return f},Z=function(a){!a||null==a||"null"==a||"string"==typeof a&&""==a.trim()?a=0:(a=""+a,0<=a.indexOf(".")&&(a=""+Number(a).toFixed(2)),a=a.split("."),3<a[0].length&&(a[0]=a[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,".")),a=a.join(","));return a}};
//# sourceMappingURL=plani3d-maps.min.js.map