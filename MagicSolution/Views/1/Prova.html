<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />

    <title></title>
    <script type="text/javascript">

        

       

        function myFunction() {
            //alert("ciao");
            //var connection = new ActiveXObject("ADODB.Connection");

            //var connectionstring = "Data Source=192.168.2.200;Initial Catalog=Prime_dev;Persist Security Info=True;User ID=sa;Password=ilos#2013;Provider=SQLOLEDB";

            //connection.Open(connectionstring);
            //var rs = new ActiveXObject("ADODB.Recordset");

            //rs.Open("SELECT * FROM Base.Person", connection);
            //rs.MoveFirst
            //while (!rs.eof) {
            //    debugger;
            //    document.write(rs.fields(1));
            //    rs.movenext;
            //}

            //rs.close;
            //connection.close;


            var url = document.location.href;
            var urlL = url.length;

            var ID = url.substr(urlL - 1, 1);

            alert(ID);

            $.ajax({
                type: "POST",
                url: "/api/GENERICSQLCOMMAND/GetWithFilter",
                data: JSON.stringify({ table: "Base.V_Person", where: "ID=" + ID + " and PersonTypeCode = 'CLI'" }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (result) { //do something with the data in result  }
                    var data = result.Data[0].Table;
                    document.getElementById("FullDescription").value = data[0]["FullDescription"];
                    document.getElementById("Municipality").value = data[0]["Municipality"];
                    document.getElementById("Address").value = data[0]["Address"];
                    document.getElementById("PostalCode").value = data[0]["PostalCode"];
                    document.getElementById("VatNumber").value = data[0]["VatNumber"];
                    document.getElementById("Province").value = data[0]["Province_abbr"];
                    /*
                    var url = new URL(url_string);
                    var c = url.searchParams.get("c");
                    console.log(c);*/
                }
            });
        }
        function Save(document) {
            var obj = {};
            obj.SDI = document.getElementById("SDI").value;
            obj.PEC = document.getElementById("PEC").value


            requireConfigAndMore(["MagicSDK"], function (MF) {
                MF.api.get({ storedProcedureName: "FatEle.FillCustomerData", data: obj }).then(function (res) {
                    
                })
            });

        }
        $(document).ready(function () {
            myFunction();
        });
    </script>
    <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">-->
</head>
<body>
    <p size="30px">
        Vi chiediamo la cortesia di indicare il Codice Univoco di accesso al Sistema di Interscambio o,
        in alternativa, il Vostro indirizzo di posta elettronica certificata (PEC).
    </p>
    <table class="table">
        <tbody>
            <tr>
                <td>
                <div class="row">
                    <div class="col" style="background-color:white;"></div>
                    <div class="col" style="background-color:whitesmoke;">
                        <table>
                            <tr  width="100%">
                                <td width="25%">
                                    <label>
                                        Ragione sociale
                                    </label>
                                </td>
                                <td  width="25%">
                                    <input type="text" id="FullDescription" size = "50" />
                                </td>
                                <td  width="25%">
                                    <label>
                                        Indirizzo
                                    </label>
                                </td>
                                <td  width="25%">
                                    <input type="text" id="Address" size = "50" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td  width="25%">
                                    <label>
                                        Localit&agrave;
                                    </label>
                                </td>
                                <td  width="25%">
                                    <input type="text" id="Municipality" size = "50" readonly />
                                </td>
                                <td  width="25%">
                                    <label>
                                        CAP
                                    </label>
                                </td>
                                <td  width="25%">
                                    <input type="text" id="PostalCode" size = "50"  readonly />
                                </td>
                            </tr>
                            <tr>
                                <td  width="25%">
                                    <label>
                                        Provincia
                                    </label>
                                </td>
                                <td>
                                    <input type="text" id="Province" size = "50" readonly />
                                </td>
                                <td  width="25%">
                                    <label>
                                        Partita IVA
                                    </label>
                                </td>
                                <td>
                                    <input type="text" id="VatNumber" size = "50" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td  width="25%">
                                    <label>
                                        SDI
                                    </label>
                                    <input type="text" id="SDI" size = "50" />
                                </td>
                            </tr>
                            <tr>
                                <td  width="25%">
                                    <label>
                                        PEC
                                    </label>
                                    <input type="text" id="PEC" size = "50" />
                                </td>
                            </tr>
                        </table>

                    </div>
                    <div class="col" style="background-color:white;"></div>
                </div>
               </td>
            </tr>
        </tbody>
    </table>
    <button onclick="Save(document)"> Salva</button>
</body>
</html>